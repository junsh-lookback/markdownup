# markdownup

MarkdownファイルをHTMLに変換して表示する。

## 概要

**markdownup** は、MarkdownファイルをWebサーバーを通じて表示するツールです。

- **自動HTML変換**: MarkdownをHTMLに変換して表示
- **Mermaid図表対応**: 図表やダイアグラムを自動レンダリング
- **拡張機能不要**: ブラウザだけで完結

## 機能

**主な特徴**

- UTF-8エンコーディング対応
- ディレクトリブラウジング機能
- ポート自動選択機能（指定ポートが使用中の場合は代替ポートを自動選択）
- MarkdownをHTMLに変換
- Mermaid図表サポート
- コード構文ハイライト対応
- テーブル、リスト、コードブロック対応
- カスタムルートディレクトリ指定
- 見出し折りたたみ機能（クリックまたはキーボードで展開/折りたたみ）
- 印刷機能（目次自動生成、ページ番号、見出しマーク）
- ロゴ表示機能（--header オプション）

## インストール

### 前提条件

- Python 3.6以上

### セットアップ

1. リポジトリをクローン:
```bash
git clone https://github.com/yourusername/markdownup.git
cd markdownup
```

2. パッケージをインストール（`markdownup` コマンドを作る）:

```bash
python -m pip install -e ".[render]"
```

> **注意**: `[render]` オプションは必須です。これにより以下のパッケージがインストールされます：
> - `markdown`: MarkdownをHTMLに変換（テーブル、目次、アンカーリンクなど）
> - `pygments`: コードのシンタックスハイライト
> 
> `[render]` なしでインストールすると、簡易的な変換機能のみとなり、多くの機能が制限されます。

## 使用方法

### 基本的な起動

```bash
markdownup
```

MarkdownをHTMLに変換して、ブラウザで直接表示します。拡張機能は不要です。

- デフォルトポートは **8000** です
- ポート番号を変更するには `--port` オプションを使用します

### ディレクトリ指定

特定のディレクトリをルートとして起動できます：

```bash
markdownup --directory /path/to/docs
```

### サービス管理

**停止:**

```bash
markdownup --stop
```

**再起動:**

```bash
markdownup --restart
```

**即座に停止**: サーバー実行中に **Ctrl+C** を押すことで即座に停止できます（確認不要）。

## 使用例

```bash
# ヘルプを表示
markdownup

# サーバーを起動（カレントディレクトリをルートとして）
markdownup --port 8000

# 特定のディレクトリをルートとして起動
markdownup -d /path/to/docs

# ホームディレクトリのnotesフォルダを公開
markdownup --directory ~/notes

# サービスを停止
markdownup --stop

# サービスを再起動
markdownup --restart
```

## アクセス方法

サーバー起動後、以下のURLでアクセスできます：

- **ローカル**: http://localhost:8000
- **ネットワーク**: http://pi.local:8000 または http://192.168.1.x:8000

## キーボードショートカット

ブラウザでMarkdownページを表示中に、以下のショートカットが使用できます：

| ショートカット | 機能 |
|--------------|------|
| **↑ / ↓** | 見出し（H2/H3/H4）間をフォーカス移動 |
| **Ctrl+Enter** | マウスカーソル位置の見出し配下を展開/折りたたみ |
| **Ctrl+Alt+R** | 見出しレベル2（h2）を一括で展開/折りたたみ（交互） |
| **Ctrl+Alt+→** | 同ディレクトリの次の `.md` ページへ移動 |
| **Ctrl+Alt+←** | 同ディレクトリの前の `.md` ページへ移動 |
| **Ctrl+Alt+↑** | 親ディレクトリへ移動 |

### 見出し折りたたみの使い方

- **見出し（H2/H3/H4）をクリック**すると、その見出し配下を折りたたみ/展開できます
- **↑↓キー**で見出し間を移動し、フォーカスされた見出しは青色でハイライトされます
- マウスカーソルを見出しに乗せて **Ctrl+Enter** でも折りたたみ/展開可能
- `Ctrl+Alt+R` で見出しレベル2を一括操作できます

## オプション

```
-h, --help                  ヘルプを表示
-p PORT, --port PORT        ポート番号を指定（デフォルト: 8000）
-d DIR, --directory DIR     サーバーのルートディレクトリを指定（デフォルト: カレントディレクトリ）
--header                    画面右上にロゴ表示、印刷時にcredits.md表示
--stop                      実行中のサービスを停止
--restart                   実行中のサービスを再起動
```

### --header オプション

`--header` オプションを指定すると、以下の機能が有効になります：

1. **画面表示**: スクリプトディレクトリの `images/logo.png` を画面右上に表示
2. **印刷時**: スクリプトディレクトリの `credits.md` を最初のページ右上に表示

```bash
# ロゴとcreditsを有効にして起動
markdownup --directory ./docs --header
```

必要なファイル：
- `images/logo.png` - 画面右上に表示されるロゴ画像
- `credits.md` - 印刷時に表示される著作権情報等

## 主な機能説明

### ディレクトリブラウジング

ディレクトリにアクセスすると、以下が表示されます：
- サブディレクトリの一覧（📁 アイコン付き）
- Markdownファイルの一覧（📝 アイコン付き）
- 親ディレクトリへの移動リンク

### カスタムルートディレクトリ

`--directory` オプションで、任意のディレクトリをサーバーのルートとして起動できます：

```bash
# プロジェクトのドキュメントディレクトリを公開
markdownup --directory ./docs

# 特定のパスを公開
markdownup --directory /home/user/wiki
```

指定したディレクトリ配下のファイルのみがアクセス可能になります。

### HTMLテンプレート

GitHub互換のCSSを使用しています。

### コード構文ハイライト

Pygmentsがインストールされている場合、コードブロックに自動的に構文ハイライトが適用されます。

```python
# コードブロック例
def hello_world():
    print("Hello, World!")
```

### サービス管理機能

- **停止**: `--stop` オプションで実行中のサービスを停止
- **再起動**: `--restart` オプションで同じ設定で再起動
- **Ctrl+C**: キーボードショートカットで即座に停止（確認不要）
- PIDファイルで複数サービスの管理をサポート

### 印刷機能（Ctrl+P）

ブラウザの印刷機能（Ctrl+P）で、以下の機能が自動的に適用されます：

- **目次自動生成**: H2/H3/H4 見出しから階層的な目次を生成
- **ページ番号**: フッター中央に「現在ページ / 総ページ数」形式で表示
- **見出しマーク**: H2に■、H3に●、H4に・を自動付与
- **改ページ制御**: H2の前で自動改ページ、見出し直後の改ページ抑制
- **credits表示**: `--header` オプション時、最初のページ右上に `credits.md` の内容を表示
- **ロゴ非表示**: 印刷時はロゴ画像を非表示

印刷設定の推奨：
- 用紙サイズ: A4
- 余白: 狭め（または「なし」でCSS余白を使用）

## トラブルシューティング

### ポートが既に使用中の場合

自動的に代替ポート（8001、8080、8888、9000、3000）を順番に試します。

### サービスを停止できない場合

PIDファイルが破損している場合は、手動で削除できます：

**Linux/macOS:**
```bash
rm ~/.markdownup/pid
```

**Windows:**
```cmd
del %USERPROFILE%\.markdownup\pid
```

### 再起動がうまくいかない場合

一度停止してから再度起動してください：

```bash
markdownup --stop
markdownup
```

### markdownパッケージがインストールされていない

以下を実行してください：
```bash
pip install markdown pygments
```

マークダウンパッケージがない場合は、簡易的なHTML変換が行われます。

### 文字化けが発生する場合

UTF-8エンコーディングで正しく配信されています。ブラウザの文字エンコーディング設定を確認してください。

## 必須パッケージ

- **markdown**: MarkdownをHTMLに変換
- **pygments**: コード構文ハイライト

```bash
pip install markdown pygments
```

## オプションパッケージ

これらのパッケージがインストールされていなくても基本的な機能は動作します。

## ライセンス

MITライセンス

## 注意事項

- 本ツールはローカルネットワークでの使用を想定しています
- 本番環境での使用は推奨されません
- セキュリティ設定を必要に応じてカスタマイズしてください

